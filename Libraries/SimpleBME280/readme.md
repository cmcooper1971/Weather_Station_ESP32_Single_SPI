
# SimpleBME280

Библиотека Arduino для I2C метеодатчика 3-в-1 Bosch Sensortec BME280.



## Описание датчика

**Датчик BME280 (температура, влажность, давление)** — новое поколение датчиков давления от [Bosch Sensortec](https://www.bosch-sensortec.com/products/environmental-sensors/humidity-sensors-bme280/).

BME280 - датчик влажности, специально разработанный для мобильных приложений и носимых устройств, где размер и низкое энергопотребление являются ключевыми параметрами. Датчик сочетает в себе высокую линейность и точность. Идеально подходит для приложений с низким потреблением тока, долговременной стабильностью и высокой устойчивостью к электромагнитным помехам. Датчик влажности обеспечивает чрезвычайно быстрое время отклика и, следовательно, поддерживает использование в высокопроизводительных приложениях. Для подключения используется шина I2C.

### Характеристики BME280 I2C

| Параметр                                       | Значение                                                |
| ---------------------------------------------- | ------------------------------------------------------- |
| Интерфейсы подключения                         | I2C                                                     |
| Адрес BME280                                   | 0x76                                                    |
| **Питание**                                    |                                                         |
| Максимальное быстродействие интерфейса I2C     | 3,4 МГц                                                 |
| Напряжение питания                             | 1,71 … 3,6 В                                            |
| Среднее потребление тока (частота опроса 1 Гц) |                                                         |
| - измерение H, T                               | 1,8 мкА                                                 |
| - измерение P, T                               | 2,8 мкА                                                 |
| - измерение H, P, T                            | 3,6 мкА                                                 |
| Среднее потребление тока в режиме сна          | 0,1 мкА                                                 |
| **Измерение температуры**                      |                                                         |
| Пределы                                        | –40 … 85 °C                                             |
| Точность                                       | 0,5 … 1 °C                                              |
| **Измерение влажности**                        |                                                         |
| Пределы                                        | 0 … 100%                                                |
| Точность                                       | 3% RH                                                   |
| Гистрезис                                      | ≤2% RH                                                  |
| **Измерение давления**                         |                                                         |
| Пределы                                        | 30 … 110 кПа                                            |
| RMS шум                                        | 0,2 Па (эквивалентно 1,7 см)                            |
| Погрешность                                    | ±0.25% (эквивалентно 1 м при изменении высоты на 400 м) |

Докуметация от производителя — [PDF](https://www.bosch-sensortec.com/media/boschsensortec/downloads/datasheets/bst-bme280-ds002.pdf).



## Установка

### Используя Arduino IDE Library Manager

1. Откройте Менеджер библиотек `Скетч > Подключить библиотеку > Управлять библиотеками...` (`Ctrl+Shift+I`).
2. Введите `SimpleBME280` в поле поиска.
3. Выберите строку с библиотекой.
4. Выберите версию и щелкните кнопку `Установка`.

### Используя Git

```sh
cd ~/Documents/Arduino/libraries/
git clone https://gitlab.com/riva-lab/SimpleBME280 SimpleBME280
```



## Подключение

Датчик использует 4 провода для подключения. Два из них — питание, 3,3В (если плата со стабилизатором — 5В). Два — шина I2C.

| Arduino       | Вывод I2C SDA | Вывод I2C SCL |
| ------------- | ------------- | ------------- |
| Uno, Ethernet | A4            | A5            |
| Mega2560      | 20            | 21            |
| Leonardo      | 2             | 3             |
| Due           | 20, SDA1      | 21, SCL1      |



## Программный интерфейс

```c++
uint8_t     begin();                    // инициализация датчика и библиотеки
void        reset();                    // сброс
```

### Настройка

```c++
void        mode(BME280mode_t x);       // режим работы
void        period(BME280period_t x);   // период неактивности (больше период - меньше частота замеров)
void        filter(BME280filter_t x);   // коэффициент фильтрации
```

### Коэффициент передискретизации (к.п.) канала измерения

```c++
void        oversampling(BME280oversampling_t x, char channel); // установка к.п. канала (канал: t/p/h)
void        oversamplingT(BME280oversampling_t x);              // установка к.п. канала темп-ры
void        oversamplingP(BME280oversampling_t x);              // установка к.п. канала давления
void        oversamplingH(BME280oversampling_t x);              // установка к.п. канала влажности
```

### Работа с датчиком

```c++
void        update();   // считывание и обработка данных датчика
float       getT();     // [гр.C] температура
uint32_t    getP();     // [ Па ] давление абсолютное
float       getH();     // [ %  ] влажность относительная
```



### Используемые библиотекой типы данных

#### Коэффициент передискретизации

```c++
typedef enum {
  bmeoSkip = 0,     // канал измерения выключен (считывается 0x800000)
  bmeo1,            // x1
  bmeo2,            // x2
  bmeo4,            // x4
  bmeo8,            // x8
  bmeo16            // x16
} BME280oversampling_t;
```

#### Режим работы

```c++
typedef enum {
  bmemSleep = 0,    // ожидание (сон)
  bmemForced,       // однократный запуск (после чего - возврат к ожиданию)
  bmemNormal = 3    // нормальный (циклический автоматический запуск измерения)
} BME280mode_t;
```

#### Коэффициент рекурсивного фильтра (IIR filter)

```c++
typedef enum {
  bmefOff = 0,      // фильтр выключен
  bmef2,            // 2
  bmef4,            // 4
  bmef8,            // 8
  bmef16            // 16
} BME280filter_t;
```

#### Период неактивности датчика (между циклами измерениями)

```c++
typedef enum {
  bmep0_5ms = 0,    // 0,5 мс
  bmep62_5ms,       // 62,5 мс
  bmep125ms,        // 125 мс
  bmep250ms,        // 250 мс
  bmep500ms,        // 500 мс
  bmep1s,           // 1 с
  bmep10ms,         // 10 мс
  bmep20ms          // 20 мс
} BME280period_t;
```



## Примеры

##### Простейший пример опроса датчика

```c++
#include "SimpleBME280.h"
SimpleBME280 bme280;

void setup() {
  Serial.begin(115200);

  if (bme280.begin() == 0)
    Serial.print(F("BME280 initialized.\n"));

  //  Библиотека инициализируется с параметрами по умолчанию (те, что сейчас закомментированы).
  //  Чтобы задать свой параметр, раскомментируйте строку и впишите нужное значение аргумента.
  //  bme280.mode(bmemNormal);
  //  bme280.period(bmep250ms);
  //  bme280.filter(bmef8);
  //  bme280.oversamplingT(bmeo2);
  //  bme280.oversamplingH(bmeo4);
  //  bme280.oversamplingP(bmeo16);
}

void loop() {
  bme280.update();
  float t = bme280.getT();
  float p = bme280.getP();
  float h = bme280.getH();

  Serial.print(F("  T = "));  Serial.print(t, 2);
  Serial.print(F("  P = "));  Serial.print(p, 2);
  Serial.print(F("  H = "));  Serial.print(h, 2);
  Serial.print(F("\n\n"));

  delay(1000);
}
```

Подробные примеры смотрите в каталоге [examples](examples).



## Лицензия

Библиотека распространяется под [лицензией](license) [MIT](https://opensource.org/licenses/mit-license.php).



## Связанные библиотеки

Для расчета других метеопараметров может быть использована библиотека [SimpleMeteoCalc](https://gitlab.com/riva-lab/SimpleMeteoCalc).

